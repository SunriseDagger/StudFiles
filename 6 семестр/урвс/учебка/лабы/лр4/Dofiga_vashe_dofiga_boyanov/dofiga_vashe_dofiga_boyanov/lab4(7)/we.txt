#include<stdio.h>

#include<stdlib.h>

#include<sys/stat.h>

#include<fcntl.h>
main()

{
int f,f1;

int i,j,k,m,n,l,st;

float x,y,s;

struct stat info;
FILE *res;
printf("Введите n- для суммы от i=1 до n( от 1 до 10000)\n");scanf("%d",&n);

printf("Введите m- число точек разбиения интервала [-1;1](от 1 до 10000)\n");scanf("%d",&m);

f1=open("file1",O_WRONLY|O_CREAT,0644);
/*открыть файл для записи в родительском процессе*/
  if (fork()==0)//создадим дочерний процесс
  {
  f=open("file1",O_RDONLY);//в нём откроем file1 для чтения
  res=fopen("resultjul","w");//и ещё один для записи результата
  l=1;

  for(;;)//цикл, пока не пердано ключевое слово(-100)
    {
    j=stat("file1",&info);//получаем информацию о file1
    if(info.st_size>=4*l)
//если в него звписан хотя бы 1 байт
       {
       read(f,&s,sizeof(s));//читаем из file1 в переменную s
       if(s==-100)break;//если s=ключевому слову

       fprintf(res,"f(%f)=%f\n",((l-1)*2./m-1.0),s);//записываем s в resultjul

       l++;

       };
    };

  fclose(res);//закрываем файлы
  close(f);
  exit(0);//завершение процесса
  };


for(i=0;i<m+1;i++)
// цикл по числу точек разбиения
{

//x=(i+0.0)*pi/m;
//определяем текущий x
x=i*2./m-1;
y=0;//y - сумма ряда
s=x;
//s - k-тый член ряда
for(k=1;k<=n;k++)//вычисляем сумму от 1 до N
{
y=y+s;
s=s*x*x/(2*k+1);
};
write(f1,&y,sizeof(y));
//записываем в file1 y
};
//посчитали функцию для всех точек разбиения
y=-100;
//передадим дочернему процессу ключ. слово  -100
write(f1,&y,sizeof(y));
//записываем в file1 y=-100
close(f1);//закрываем file1
wait(&st);/*заблокировать выполнение процесса,
          пока кто-либо из его потомков не прекратит существование*/
exit(0);
//завершение процесса
}