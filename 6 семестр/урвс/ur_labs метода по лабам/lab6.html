<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>

 <head>
  <title>Лабораторная работа № 6</title>
  <meta http-equiv=Content-Type content="text/html; charset=windows-1251">
  <link rel="stylesheet" type="text/css" href="textstyle.css">
  <!--base href="http://ami.nstu.ru/~vms/method6/"-->
 </head>

 <body>

  <div class="header">
   Лабораторная работа № 6
  </div>
  <div class="mainheader">
   Моделирование работы интерпретатора
  </div>
  
  <div class="header">
   Цель работы
  </div>
  <div class="abzac">
   Практическое освоение средств управления ресурсами ОС UNIX на основе разработки программы, моделирующей работу 
   интерпретатора в плане создания процессов, реализующих команды в командной строке, их синхронизации и 
   взаимодействию по данным.
  </div>
  
  <div class="header">
   Содержание работы
  </div>
  <ol>
   <li>
    Изучить программные средства наследования дескрипторов файлов (системные вызовы <span class="code">dup()</span>, 
    <span class="code">fcntl()</span>).
   </li>
   <li>
    Ознакомиться с заданием к лабораторной работе. 
   </li>
   <li>
    Выбрать набор системных вызовов, обеспечивающих решение задачи. 
   </li>
   <li>
    Для указанного варианта составить программу на языке Си, реализующую требуемые действия. 
   </li>
   <LI>
    Отладить и оттестировать составленную программу, используя инструментарий ОС UNIX. 
   </li>
   <li>
    Защитить лабораторную работу, ответив на контрольные вопросы.
   </li>
  </ol>

  <div class="header">
   Методические указания к лабораторной работе
  </div>
  <div class="abzac">
   При выполнении операции перенаправления ввода-вывода важным моментом является наследование пользовательских дескрипторов, 
   осуществляемое с помощью системных вызовов <span class="code">dup()</span> и <span class="code">fcntl()</span>.
  </div>
  <div class="abzac">
   Системный вызов <span class="code">dup()</span> обрабатывает свой единственный параметр как пользовательский дескриптор 
   открытого файла и возвращает целое число, которое может быть использовано как еще один пользовательский дескриптор того 
   же файла. С помощью копии пользовательского дескриптора файла к нему может быть осуществлен доступ того же типа и с 
   использованием того же значения указателя записи-чтения, что и с помощью оригинального пользовательского дескриптора файла.
  </div>
  <div class="abzac">
   Системный вызов fcntl(), имеющий формат
  </div>
<pre>
int fcntl(int fd, char command, int argument);
</pre>
  <div class="abzacWithoutIndent">
   выполняет действия по разделению пользовательских дескрипторов в зависимости от пяти значений аргумента command, 
   специфицированных в файле <span class="code">fcntl.h</span>. Например, при значении второго аргумента, равного <span class="code">F_DUPFD</span>, 
   системный вызов <span class="code">fcntl()</span> возвращает первый свободный дескриптор файла, значение которого не меньше 
   значения аргумента <span class="code">argument</span>. Этот пользовательский дескриптор файла должен быть копией 
   пользовательского дескриптора файла, заданного аргументом <span class="code">fd</span>.
  </div>
  <div class="abzac">
   С помощью системных вызовов <span class="code">dup()</span> и <span class="code">fcntl()</span> пользовательские программы, 
   а также и интерпретатор команд Shell реализуют каналы и переназначение стандартного ввода и стандартного вывода на файл. 
   Пусть, например, некоторая программа <span class="code">prog</span> читает данные из стандартного входного потока и выводит 
   результаты в стандартный выходной поток. Для того, чтобы та же программа читала данные из файла <span class="code">aa.txt</span>, 
   а осуществляла вывод в файл <span class="code">bb.txt</span>, необходимо выполнить:
  </div>
<pre>
#include &lt;fcntl.h&gt;
...............
int fd, fd2;
fd = open("aa.txt", O_RDONLY);
close(0);
fcntl(fd,F_DUPFD,0);
fd = open("bb.txt", O_WRONLY | O_CREAT);
close(1);
fcntl(fd2, F_DUPFD, 1);
execlp("prog", "prog", 0);
</pre>
  <div class="abzac">
   Интерпретатор Shell представляет собой обычную, с точки зрения пользователя, программу, которая в ходе своего функционирования 
   создаёт процессы, реализующие простые команды командного языка, выполняет перенаправление ввода-вывода, строит программные 
   каналы между командами и т.д. Например, схему обработки командной строки
  </div>
<pre>
cat < a.txt | sort | pr
</pre>
  <div class="abzacWithoutIndent">
   интерпретатором команд, опуская детали, связанные с наследованием дескрипторов файлов, можно представить в виде:
  </div>
  <div class="picture">
   <img src="images/p6_0.jpg">
  </div>

  <div class="header">
   Варианты заданий
  </div>
  <div class="abzac">
   Составить программу, моделирующую работу Shell-интерпретатора при обработке командной строки, указанной в варианте. 
   При реализации программы путём выдачи сообщений информировать обо всех этапах ее работы (создан процесс, выполнение 
   команды закончено и т.д.).
  </div>
  <ol>
   <li class="code">
    (cc pr1.c &amp; cc pr2.c) &amp;&amp; cat pr1.c pr2.c &gt; prall.c.
   </li>

   <li class="code">
    wc -c &lt; a.txt &amp; wc -c &lt; b.txt &amp; cat a.txt b.txt | wc -c &gt; c.txt.
   </li>

   <li class="code">
    who | wc -l &amp; ps | wc -l.
   </li>

   <li class="code">
    tr -d "[p-z]" &lt; a.txt | wc -c &amp; wc -c &lt; a.txt.
   </li>

   <li class="code">
    ls -la &gt; a.txt &amp; ps &gt; b.txt; cat a.txt b.txt | sort.
   </li>

   <li class="code">
    ls -lisa | sort | wc -l &gt; a.txt.
   </li>

   <li class="code">
    cat a.txt b.txt c.txt | tr -d "[a-i]" | wc -w.
   </li>

   <li class="code">
    ls -al | wc -l &amp;&amp; cat a.txt b.txt &gt; c.txt.
   </li>

   <li class="code">
    tr -d "[0-9]" &lt; a.txt | sort | uniq &gt; b.txt.
   </li>

   <li class="code">
    ls -al | grep "April" | wc -l &gt; a.txt.
   </li>
  </ol>

 </body>
</html>
